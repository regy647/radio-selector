<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Radio Odiseja</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2em;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 0.5em;
    }
    /* —— DEVICE CASING —— */
    .device {
      width: 600px;
      height: 300px;
      margin: 2em auto;
      background: #222;
      border: 4px solid #444;
      border-radius: 25px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding-left: 110px;
      padding-right: 30px;
      gap: 20px;
      position: relative;
    }
    /* The one physical button */
    .device .knob {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      box-shadow: inset 0 0 5px #000;
      cursor: pointer;
      align-self: flex-start;
      margin-top: 60px;
      transform: translateX(-40px);
      transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
    }
    .device .knob:hover {
      background: #999;
      box-shadow:
        inset 0 0 8px rgba(0,0,0,0.8),
        0 4px 6px rgba(0,0,0,0.6);
      transform: translateX(-40px) scale(1.05);
    }
    .device .knob:active {
      background: #aaa;
      box-shadow:
        inset 0 0 5px rgba(0,0,0,0.9),
        0 2px 3px rgba(0,0,0,0.6);
      transform: translateX(-40px) translateY(2px) scale(0.92);
    }
    /* Screen inside the case */
    .device .screen {
      flex: none;
      width: 450px;
      height: 160px;
      border: 2px solid #0F0E37;
      border-radius: 12px;
      background: #111;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 1em 1em 0 1em;
      text-align: left;
    }
    .screen .line1 {
      color: #FFFFFF;
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 1.5em;
      letter-spacing: 0.5px;
    }
    .screen .line2 {
      color: #CCCCCC;
      font-size: 1.2em;
      opacity: 1;
      letter-spacing: 0.5px;
    }
    /* Pause/Resume below */
    .buttons {
      margin-top: 1em;
    }
    .buttons button {
      margin: 0.5em;
      padding: 0.8em 1.5em;
      font-size: 1em;
      background-color: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .buttons button:hover {
      background-color: #666;
    }
  </style>
</head>
<body>
  <h1>Loading…</h1>

  <div class="device">
    <div class="knob" id="knob"></div>
    <div class="screen">
      <div class="line1" id="screenLine1">No playlist loaded</div>
      <div class="line2" id="screenLine2">Nothing playing</div>
    </div>
  </div>

  <div class="buttons">
    <button onclick="togglePause()">⏯ Pause / Resume</button>
  </div>

  <audio id="player" style="display:none"></audio>

  <script>
    // ── CLIENT / LOGIN CONFIG ─────────────────────────────────────────────────────
    const CLIENT_CONFIGS = [
      {
        password:        "odiseja",
        clientName:      "odiseja",
        displayTitle:    "📻 Radio Odiseja",
        allowedPlaylists:[
          "70s_POP","80s_POP","90s_POP",
          "POP_ROCK","Easy80s90s",
          "Movie_HITS","Movie_INSTRUMENTAL"
        ],
        ads: ["spot1.mp3","spot2.mp3","spot3.mp3"]
      },
      {
        password:        "bigbang",
        clientName:      "bigbang",
        displayTitle:    "📻 Radio BigBang",
        allowedPlaylists:[
          "70s_POP","80s_POP","90s_POP",
          "POP_ROCK","Easy80s90s",
          "Movie_HITS","Movie_INSTRUMENTAL"
        ],
        ads: ["spotA.mp3","spotB.mp3"]
      }
    ];
  
    // ── LOGIN & INITIALIZATION ────────────────────────────────────────────────────
    const pw  = prompt("Enter your password:");
    const cfg = CLIENT_CONFIGS.find(c => c.password === pw);
    if (!cfg) {
      alert("Invalid password");
      throw new Error("Authentication failed");
    }
  
    const {
      clientName,
      displayTitle,
      allowedPlaylists: playlists,
      ads: adFiles
    } = cfg;
  
    document.querySelector("h1").textContent = displayTitle;
  
    // ── SETTINGS & STATE ──────────────────────────────────────────────────────────
    const player   = document.getElementById("player");
    const line1    = document.getElementById("screenLine1");
    const line2    = document.getElementById("screenLine2");
    const knob     = document.getElementById("knob");
  
    let playlistIdx      = 0;
    let currentFolder    = "";
    let trackList        = [];
    let trackIdx         = 0;
    let sinceLastAd      = 0;
    const ADS_INTERVAL   = 3;
    let inSpecial        = false;  // true while a jingle or ad is playing
  
    // ── HELPERS ───────────────────────────────────────────────────────────────────
    const randomIndex = arr => Math.floor(Math.random() * arr.length);
    const randomItem  = arr => arr[randomIndex(arr)];
  
    function play(src, isSpecial = false) {
      inSpecial = isSpecial;
      player.src = src;
      player.play();
      if (isSpecial) line2.textContent = "";
    }
  
    function displayTrackTitle(fn) {
      const name  = fn.replace(/\.mp3$/i, "").trim();
      const [artist, ...rest] = name.split(" - ");
      const title = rest.join(" - ")
        .replace(/\s+(Official|Video|Remaster|HD|Lyrics|Audio).*$/i, "")
        .trim();
      line1.textContent = currentFolder;
      line2.textContent = rest.length ? `${artist} — ${title}` : name;
    }
  
    // ── PLAY SEQUENCES ─────────────────────────────────────────────────────────────
    function loadPlaylist(folder) {
      currentFolder = folder;
      line1.textContent = folder;
      line2.textContent = "";
      sinceLastAd = 0;
  
      fetch(`playlists/${folder}/${folder}.json`)
        .then(r => r.json())
        .then(data => {
          trackList = data;
          trackIdx  = randomIndex(data);
          playBrandJingle();
        })
        .catch(() => {
          line1.textContent = "⚠️ Error loading playlist";
          line2.textContent = "";
        });
    }
  
    function playBrandJingle() {
      const path = `jingles/${clientName}/brand/jingle_${currentFolder}.mp3`;
      fetch(path)
        .then(r => r.ok ? play(path, true) : Promise.reject())
        .catch(() => playTrack());
    }
  
    function playNextAd() {
      if (!adFiles.length) return playTrack();
      const spot = randomItem(adFiles);
      play(`jingles/${clientName}/ads/${spot}`, true);
    }
  
    function playTrack() {
      if (trackIdx >= trackList.length) {
        line1.textContent = "🎵 End of playlist";
        line2.textContent = "";
        return;
      }
      const file = trackList[trackIdx];
      displayTrackTitle(file);
      play(`playlists/${currentFolder}/${encodeURIComponent(file)}`, false);
    }
  
    // ── AUTO ADVANCE ───────────────────────────────────────────────────────────────
    player.onended = () => {
      if (inSpecial) {
        // after jingle or ad, play the next track
        inSpecial = false;
        playTrack();
      } else {
        // after track, increment and maybe run an ad
        trackIdx++;
        sinceLastAd++;
        if (sinceLastAd >= ADS_INTERVAL) {
          sinceLastAd = 0;
          playNextAd();
        } else {
          playTrack();
        }
      }
    };
  
    // ── PAUSE / RESUME ─────────────────────────────────────────────────────────────
    function togglePause() {
      if (!player.src) return;
      if (player.paused) {
        player.play();
        displayTrackTitle(trackList[trackIdx]);
      } else {
        player.pause();
        line2.textContent = "⏸️ Paused";
      }
    }
  
    // ── KNOB INTERACTIONS ──────────────────────────────────────────────────────────
    let holdTimer, held = false;
    knob.addEventListener("mousedown", () => {
      held = false;
      holdTimer = setTimeout(() => {
        held = true;
        togglePause();
      }, 2000);
    });
    knob.addEventListener("mouseup", () => {
      clearTimeout(holdTimer);
      if (held) return;
      // short press → next playlist
      playlistIdx = (playlistIdx + 1) % playlists.length;
      loadPlaylist(playlists[playlistIdx]);
    });
  
    // support touch on mobile
    knob.addEventListener("touchstart", e => {
      e.preventDefault();
      held = false;
      holdTimer = setTimeout(() => {
        held = true;
        togglePause();
      }, 2000);
    });
    knob.addEventListener("touchend", e => {
      e.preventDefault();
      clearTimeout(holdTimer);
      if (held) return;
      playlistIdx = (playlistIdx + 1) % playlists.length;
      loadPlaylist(playlists[playlistIdx]);
    });
  
    // ── START UP ──────────────────────────────────────────────────────────────────
    if (playlists.length) {
      loadPlaylist(playlists[playlistIdx]);
    }
  </script>
</body>
</html>