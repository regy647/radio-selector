<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Radio Odiseja</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 2em;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 0.5em;
    }
    /* â€”â€” DEVICE CASING â€”â€” */
    .device {
      width: 600px;
      height: 300px;
      margin: 2em auto;
      background: #222;
      border: 4px solid #444;
      border-radius: 25px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding-left: 110px;
      padding-right: 30px;
      gap: 20px;
      position: relative;
    }
    /* The one physical button */
    .device .knob {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      box-shadow: inset 0 0 5px #000;
      cursor: pointer;
      align-self: flex-start;
      margin-top: 60px;
      transform: translateX(-40px);
      transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
    }
    .device .knob:hover {
      background: #999;
      box-shadow:
        inset 0 0 8px rgba(0,0,0,0.8),
        0 4px 6px rgba(0,0,0,0.6);
      transform: translateX(-40px) scale(1.05);
    }
    .device .knob:active {
      background: #aaa;
      box-shadow:
        inset 0 0 5px rgba(0,0,0,0.9),
        0 2px 3px rgba(0,0,0,0.6);
      transform: translateX(-40px) translateY(2px) scale(0.92);
    }
    /* Screen inside the case */
    .device .screen {
      flex: none;
      width: 450px;
      height: 160px;
      border: 2px solid #0F0E37;
      border-radius: 12px;
      background: #111;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 1em 1em 0 1em;
      text-align: left;
    }
    .screen .line1 {
      color: #FFFFFF;
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 1.5em;
      letter-spacing: 0.5px;
    }
    .screen .line2 {
      color: #CCCCCC;
      font-size: 1.2em;
      opacity: 1;
      letter-spacing: 0.5px;
    }
    /* Pause/Resume below */
    .buttons {
      margin-top: 1em;
    }
    .buttons button {
      margin: 0.5em;
      padding: 0.8em 1.5em;
      font-size: 1em;
      background-color: #444;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .buttons button:hover {
      background-color: #666;
    }
  </style>
</head>
<body>
  <h1>Loadingâ€¦</h1>

  <div class="device">
    <div class="knob" id="knob"></div>
    <div class="screen">
      <div class="line1" id="screenLine1">No playlist loaded</div>
      <div class="line2" id="screenLine2">Nothing playing</div>
    </div>
  </div>

  <div class="buttons">
    <button onclick="togglePause()">â¯ Pause / Resume</button>
  </div>

  <audio id="player" style="display:none"></audio>

  <script>
    // â”€â”€ CLIENT / LOGIN CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const CLIENT_CONFIGS = [
      {
        password:         "odiseja",
        clientName:       "odiseja",
        displayTitle:     "ğŸ“» Radio Odiseja",
        allowedPlaylists: [
          "70s_POP","80s_POP","90s_POP",
          "POP_ROCK","Easy80s90s",
          "Movie_HITS","Movie_INSTRUMENTAL"
        ],
        ads: [
          "spot1.mp3",
          "spot2.mp3",
          "spot3.mp3"
        ]
      },
      {
        password:         "bigbang",
        clientName:       "bigbang",
        displayTitle:     "ğŸ“» Radio BigBang",
        allowedPlaylists: [
          "70s_POP","80s_POP","90s_POP",
          "POP_ROCK","Easy80s90s",
          "Movie_HITS","Movie_INSTRUMENTAL"
        ],
        ads: [
          "spotA.mp3",
          "spotB.mp3"
        ]
      }
    ];

    // prompt + identify client
    const pw  = prompt("Enter your password:");
    const cfg = CLIENT_CONFIGS.find(c => c.password === pw);
    if (!cfg) {
      alert("Invalid password â€“ reload to try again.");
      throw new Error("no valid client");
    }

    const clientName    = cfg.clientName;
    const allowed       = cfg.allowedPlaylists;
    const adFiles       = cfg.ads;
    let   clientIndex   = 0;
    document.querySelector("h1").textContent = cfg.displayTitle;

    // â”€â”€ GLOBAL SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const startRandom     = true;
    const adsEveryNTracks = 3;

    // â”€â”€ DOM REFS & STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const player = document.getElementById("player");
    const line1  = document.getElementById("screenLine1");
    const line2  = document.getElementById("screenLine2");
    const knobEl = document.getElementById("knob");

    let currentFolder        = "";
    let currentPlaylist      = [];
    let currentIndex         = 0;
    let trackCountSinceAd    = 0;
    let isPlayingJingle      = false;
    let holdTimer            = null;
    let holdTriggered        = false;

    // â”€â”€ START-UP: auto-load first playlist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (allowed.length) loadPlaylist(allowed[clientIndex]);

    // â”€â”€ LOAD A PLAYLIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadPlaylist(folderName) {
      currentFolder     = folderName;
      line1.textContent = folderName;
      line2.textContent = "";
      trackCountSinceAd = 0;

      fetch(`playlists/${folderName}/${folderName}.json`)
        .then(r => r.json())
        .then(data => {
          currentPlaylist = data;
          currentIndex = startRandom
            ? Math.floor(Math.random() * (data.length - 1)) + 1
            : 1;
          displayTrackTitle(currentPlaylist[currentIndex]);
          playBrandJingle();
        })
        .catch(err => {
          console.error(err);
          line1.textContent = "âš ï¸ Error loading playlist";
          line2.textContent = "";
        });
    }

    // â”€â”€ PLAY BRAND JINGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function playBrandJingle() {
      const path = `jingles/${clientName}/brand/jingle_${currentFolder}.mp3`;
      fetch(path)
        .then(res => res.ok ? playAudio(path, true) : Promise.reject())
        .catch(() => playAudio("jingles/placeholder/jingle_placeholder.mp3", true));
    }

    // â”€â”€ PLAY A RANDOM AD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function playRandomAd() {
      if (!adFiles.length) {
        return playAudio("jingles/placeholder/jingle_placeholder.mp3", true);
      }
      const spot = adFiles[Math.floor(Math.random() * adFiles.length)];
      const path = `jingles/${clientName}/ads/${spot}`;
      fetch(path)
        .then(res => res.ok ? playAudio(path, true) : Promise.reject())
        .catch(() => playAudio("jingles/placeholder/jingle_placeholder.mp3", true));
    }

    // â”€â”€ PLAY NEXT TRACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function playTrack() {
      if (currentIndex >= currentPlaylist.length) {
        line1.textContent = "ğŸµ End of playlist";
        line2.textContent = "";
        return;
      }
      const track = currentPlaylist[currentIndex];
      displayTrackTitle(track);
      const url = `playlists/${currentFolder}/${encodeURIComponent(track)}`;
      playAudio(url, false);
    }

    // â”€â”€ ACTUALLY PLAY THE AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function playAudio(url, jingle = false) {
      player.src        = url;
      isPlayingJingle   = jingle;
      player.play();
      if (jingle) line2.textContent = "";
    }

    // â”€â”€ AUTO-ADVANCE HANDLER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    player.onended = () => {
      if (isPlayingJingle) {
        isPlayingJingle = false;
        playTrack();
      } else {
        currentIndex++;
        trackCountSinceAd++;
        if (trackCountSinceAd >= adsEveryNTracks) {
          trackCountSinceAd = 0;
          playRandomAd();
        } else {
          playTrack();
        }
      }
    };

    // â”€â”€ PAUSE / RESUME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function togglePause() {
      if (!player.src) return;
      if (player.paused) {
        player.play();
        displayTrackTitle(currentPlaylist[currentIndex]);
      } else {
        player.pause();
        line2.textContent = "â¸ï¸ Paused";
      }
    }

    // â”€â”€ KNOB LOGIC (short = next playlist, long = pause) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    knobEl.addEventListener("mousedown", () => {
      holdTriggered = false;
      holdTimer = setTimeout(() => {
        holdTriggered = true;
        togglePause();
      }, 3000);
    });
    knobEl.addEventListener("mouseup", () => {
      clearTimeout(holdTimer);
      if (holdTriggered) return;
      if (player.paused && player.src) {
        togglePause();
      } else {
        clientIndex = (clientIndex + 1) % allowed.length;
        loadPlaylist(allowed[clientIndex]);
      }
    });
    knobEl.addEventListener("touchstart", e => {
      e.preventDefault();
      holdTriggered = false;
      holdTimer = setTimeout(() => {
        holdTriggered = true;
        togglePause();
      }, 3000);
    });
    knobEl.addEventListener("touchend", e => {
      e.preventDefault();
      clearTimeout(holdTimer);
      if (holdTriggered) return;
      if (player.paused && player.src) {
        togglePause();
      } else {
        clientIndex = (clientIndex + 1) % allowed.length;
        loadPlaylist(allowed[clientIndex]);
      }
    });

    // â”€â”€ HELPER: CLEAN â€œArtist â€” Titleâ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function displayTrackTitle(filename) {
      const name  = filename.replace(/\.mp3$/i, "").trim();
      const parts = name.split(" - ");
      const artist = parts.shift().trim();
      const title  = parts.join(" - ")
        .replace(/\s+(Official.*|Video.*|Remaster.*|HD.*|Lyrics?.*|Audio.*)/i, "")
        .trim();
      line2.textContent = artist && title
        ? `${artist} â€” ${title}`
        : name;
    }
  </script>
</body>
</html>